== Torus SPEC (0.0.3)

(Shamelessly cribbing from the Ring Spec since 2011.)

Torus is definied in terms of handlers, middleware, request maps, and response
maps.


== Handlers

Handlers are Clojurescript functions that take a request map and return a
response map. Handlers should be referentially transparent.


== Middleware

Higher order functions that take one or more handlers and configuration options
and return a new handler with the desired compound behaviour.


== Request Map

A Clojurescript map with the following keys:

:location
  (Required, IPersistentMap)
  A map that always contains the following keys (from js/location):

  :hash
    (String)
    URL hash tag.

  :host
    (String)
    Server hostname and port.

  :hostname
    (String)
    Server domain name or IP address.

  :href
    (String)
    Complete URL.

  :origin
    (String)
    Server protocol and host.

  :pathname
    (String)
    Everything between the :origin and :hash.

  :port
    (Integer)
    Server port number.

  :protocol
    (Keyword)
    :https or :http

:history-state (optional)
  (Optional, Object)
  The state object from js/history.


== Response Map

A Clojurescript map. The keys of the map are processed in the order they
apper below.

:id
  (Required, String)
  The response id. Used to determine whether to use the response :head, :body,
  and :callback. The previous response id is stored in an atom. This value is
  checked before the rest of the response is processed. If the stored value is
  equal to the response id, :body, :head, and :callback are not used. In all
  cases :nodes is still processed.

:html
  (Required, HTMLDocument)
  The new document node from which title, head, and body will be taken.

  or

  (Required, String beginning with "<")
  The new document (as a HTML string).

  or

  (Required, String)
  A URL at which the new document can be found.

  For all the above. If the new document's title is blank, :hostname from the
  request :location is used.

  All children of the new documents' head are appended to the current document
  head, but not before the children from the previous response are removed.

  The current document's body node is replaced by that of the new document. Note
  that this means existing listeners on 'body' are discarded.

:title
  (Optional, String)
  Overrides /head/title in :html.

:install
  (Optional, Function)
  A function that is called after the new document is processed. It takes a
  single argument which is the response map.

:uninstall
  (Optional, Function)
  A function that is called before the body or head nodes associated with this
  response are removed from the document. It takes the same argument as the
  :install function.
